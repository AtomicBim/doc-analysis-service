"""
Gradio-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
"""
import os
import json
import gradio as gr
from typing import Optional, Tuple
from pathlib import Path


# ============================
# –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
# ============================

# –°–ª–æ–≤–∞—Ä—å –ø—Ä–∏–º–µ—Ä–æ–≤ –∏–º–µ–Ω –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤
# –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–ª–æ–≤–∞—Ä—å: https://example.com/naming-conventions (–ø—Ä–∏–º–µ—Ä URL)
VALIDATION_EXAMPLES = {
    "technical_assignment": [
        "tz_project.docx", "tech_assignment.pdf", "tz_rd.docx",
        "tz_", "—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ_–∑–∞–¥–∞–Ω–∏–µ", "—Ç–∑_"
    ],
    "documentation": [
        "documentation_fe.pdf", "docs_project.docx", "fe_docs.pdf",
        "documentation_", "docs_", "–ø—Ä–æ–µ–∫—Ç–Ω–∞—è_–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"
    ],
    "technical_requirements": [
        "_tu.docx", "_tu.pdf", "tech_requirements_",
        "—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ_—É—Å–ª–æ–≤–∏—è", "—Ç—É_"
    ]
}

# –°—Ç–∞–¥–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
STAGES = {
    "–ì–ö": "–ì—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è",
    "–§–≠": "–§–æ—Ä—ç—Å–∫–∏–∑–Ω—ã–π –ø—Ä–æ–µ–∫—Ç",
    "–≠–ü": "–≠—Å–∫–∏–∑–Ω—ã–π –ø—Ä–æ–µ–∫—Ç",
    "–ü–î": "–ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—Å—Ç–∞–¥–∏—è –ü)",
    "–†–î": "–†–∞–±–æ—á–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"
}

# –¢–∏–ø—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
REQUIREMENT_TYPES = {
    "–¢–ó": "–¢–ó –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)",
    "–¢–£_–†–î": "–¢–£ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –†–î",
    "–¢–£_–ü–î": "–¢–£ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ü–î",
    "–¢–£_–§–≠": "–¢–£ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –§–≠",
    "–¢–£_–≠–ü": "–¢–£ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≠–ü"
}

# –î–æ–ø—É—Å—Ç–∏–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤
ALLOWED_FORMATS = [".docx", ".pdf"]


# ============================
# –°–ò–°–¢–ï–ú–ê –ü–†–û–ú–ü–¢–û–í
# ============================

PROMPTS = {
    "–ì–ö": """<PROMPT_STAGE_PLACEHOLDER>
<–∞–Ω–∞–ª–∏–∑_–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏_–≥–∫>
<–∑–∞–¥–∞—á–∞>
–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å—Ç–∞–¥–∏–∏ –ì—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è (–ì–ö)
—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã—Ö –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π.
</–∑–∞–¥–∞—á–∞>
<–∫—Ä–∏—Ç–µ—Ä–∏–∏_–æ—Ü–µ–Ω–∫–∏>
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä—ë–º–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó
- –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ —Å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è–º–∏
- –ù–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: –Ω–µ –æ—Ç—Ä–∞–∂–µ–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö
- –¢—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
</–∫—Ä–∏—Ç–µ—Ä–∏–∏_–æ—Ü–µ–Ω–∫–∏>
</–∞–Ω–∞–ª–∏–∑_–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏_–≥–∫>""",

    "–§–≠": """<PROMPT_STAGE_PLACEHOLDER>
<–∞–Ω–∞–ª–∏–∑_–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏_—Ñ—ç>
<–∑–∞–¥–∞—á–∞>
–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å—Ç–∞–¥–∏–∏ –§–æ—Ä—ç—Å–∫–∏–∑ (–§–≠) —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.
</–∑–∞–¥–∞—á–∞>
<–∏—Å—Ö–æ–¥–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ>
1. –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å—Ç–∞–¥–∏–∏ –§–≠ –≤ —Ñ–æ—Ä–º–∞—Ç–µ PDF/DOCX, –≤–∫–ª—é—á–∞—é—â–∞—è:
  - –ì—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é —á–∞—Å—Ç—å (–ø–ª–∞–Ω—ã, —Ä–∞–∑—Ä–µ–∑—ã, —Ñ–∞—Å–∞–¥—ã, —Å—Ö–µ–º—ã)
  - –¢–µ–∫—Å—Ç–æ–≤—É—é —á–∞—Å—Ç—å (–ø–æ—è—Å–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å–∫–∞, —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≤–µ–¥–æ–º–æ—Å—Ç–∏)
2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å—Ç–∞–¥–∏–∏ –§–≠
</–∏—Å—Ö–æ–¥–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ>
<–º–µ—Ç–æ–¥–∏–∫–∞_–∞–Ω–∞–ª–∏–∑–∞>
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¢–ó:
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –µ–≥–æ —Ç–∏–ø (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ-–ø–ª–∞–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–µ, –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ–µ, –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ, —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ)
2. –ù–∞–π—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–µ–∫—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. –û—Ü–µ–Ω–∏—Ç—å –ø–æ–ª–Ω–æ—Ç—É –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
4. –í—ã—è–≤–∏—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏
</–º–µ—Ç–æ–¥–∏–∫–∞_–∞–Ω–∞–ª–∏–∑–∞>
<–∫—Ä–∏—Ç–µ—Ä–∏–∏_–æ—Ü–µ–Ω–∫–∏>
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä—ë–º–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó
- –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ —Å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è–º–∏
- –ù–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: –Ω–µ –æ—Ç—Ä–∞–∂–µ–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö
- –¢—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
</–∫—Ä–∏—Ç–µ—Ä–∏–∏_–æ—Ü–µ–Ω–∫–∏>
<–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ_—É–∫–∞–∑–∞–Ω–∏—è>
- –ü—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –æ–±—Ä–∞—â–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –º–∞—Å—à—Ç–∞–±—ã, —Ä–∞–∑–º–µ—Ä—ã, –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è
- –í —Ç–µ–∫—Å—Ç–æ–≤–æ–π —á–∞—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ—Ö–Ω–∏–∫–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
- –§–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –û—Ç–º–µ—á–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–ª—è —Å—Ç–∞–¥–∏–∏ –§–≠ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
</–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ_—É–∫–∞–∑–∞–Ω–∏—è>
</–∞–Ω–∞–ª–∏–∑_–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏_—Ñ—ç>""",

    "–≠–ü": """<PROMPT_STAGE_PLACEHOLDER>
<–∞–Ω–∞–ª–∏–∑_–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏_—ç–ø>
<–∑–∞–¥–∞—á–∞>
–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å—Ç–∞–¥–∏–∏ –≠—Å–∫–∏–∑–Ω—ã–π –ø—Ä–æ–µ–∫—Ç (–≠–ü)
—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∏ –æ–±—ä–µ–º–Ω–æ-–ø–ª–∞–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π.
</–∑–∞–¥–∞—á–∞>
<–∫—Ä–∏—Ç–µ—Ä–∏–∏_–æ—Ü–µ–Ω–∫–∏>
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä—ë–º–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó
- –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ —Å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è–º–∏
- –ù–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: –Ω–µ –æ—Ç—Ä–∞–∂–µ–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö
- –¢—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
</–∫—Ä–∏—Ç–µ—Ä–∏–∏_–æ—Ü–µ–Ω–∫–∏>
</–∞–Ω–∞–ª–∏–∑_–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏_—ç–ø>""",

    "–ü–î": """<PROMPT_STAGE_PLACEHOLDER>
<–∞–Ω–∞–ª–∏–∑_–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏_–ø–¥>
<–∑–∞–¥–∞—á–∞>
–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å—Ç–∞–¥–∏–∏ –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–ü–î)
—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.
</–∑–∞–¥–∞—á–∞>
<–∫—Ä–∏—Ç–µ—Ä–∏–∏_–æ—Ü–µ–Ω–∫–∏>
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä—ë–º–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó/–¢–£
- –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ —Å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è–º–∏
- –ù–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: –Ω–µ –æ—Ç—Ä–∞–∂–µ–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö
- –¢—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
</–∫—Ä–∏—Ç–µ—Ä–∏–∏_–æ—Ü–µ–Ω–∫–∏>
<–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ_—É–∫–∞–∑–∞–Ω–∏—è>
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–º –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ç—É —Å–æ—Å—Ç–∞–≤–∞ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏
</–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ_—É–∫–∞–∑–∞–Ω–∏—è>
</–∞–Ω–∞–ª–∏–∑_–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏_–ø–¥>""",

    "–†–î": """<PROMPT_STAGE_PLACEHOLDER>
<–∞–Ω–∞–ª–∏–∑_–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏_—Ä–¥>
<–∑–∞–¥–∞—á–∞>
–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ä–∞–±–æ—á–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–†–î) —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∏–π –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞.
</–∑–∞–¥–∞—á–∞>
<–∫—Ä–∏—Ç–µ—Ä–∏–∏_–æ—Ü–µ–Ω–∫–∏>
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä—ë–º–µ —Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó/–¢–£
- –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ —Å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è–º–∏
- –ù–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ: –Ω–µ –æ—Ç—Ä–∞–∂–µ–Ω–æ –≤ –ø—Ä–æ–µ–∫—Ç–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö
- –¢—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
</–∫—Ä–∏—Ç–µ—Ä–∏–∏_–æ—Ü–µ–Ω–∫–∏>
<–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ_—É–∫–∞–∑–∞–Ω–∏—è>
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—É—é –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ä–∞–±–æ—á–∏—Ö —á–µ—Ä—Ç–µ–∂–µ–π –∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ü–î –∏ –†–î
</–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ_—É–∫–∞–∑–∞–Ω–∏—è>
</–∞–Ω–∞–ª–∏–∑_–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏_—Ä–¥>"""
}

# –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –§–≠ –∏ –≠–ü
EMBEDDED_REQUIREMENTS = {
    "–¢–£_–§–≠": "–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Å—Ç–∞–¥–∏–∏ –§–≠: –±–∞–∑–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ–æ—Ä—ç—Å–∫–∏–∑–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –∫–æ–º–ø–∞–Ω–∏–∏.",
    "–¢–£_–≠–ü": "–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Å—Ç–∞–¥–∏–∏ –≠–ü: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —ç—Å–∫–∏–∑–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É, –≤–∫–ª—é—á–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏ –æ–±—ä–µ–º–Ω–æ-–ø–ª–∞–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è."
}


# ============================
# –§–£–ù–ö–¶–ò–ò –í–ê–õ–ò–î–ê–¶–ò–ò
# ============================

def validate_file_format(filename: str) -> Tuple[bool, str]:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–∞

    Args:
        filename: –∏–º—è —Ñ–∞–π–ª–∞

    Returns:
        (—É—Å–ø–µ—Ö, —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ)
    """
    if not filename:
        return False, "–§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω"

    file_ext = Path(filename).suffix.lower()
    if file_ext not in ALLOWED_FORMATS:
        return False, f"–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ: {', '.join(ALLOWED_FORMATS)}"

    return True, ""


def validate_file_by_name(filename: str, file_type: str) -> Tuple[bool, str]:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞ –ø–æ –∏–º–µ–Ω–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–æ–≤–∞—Ä—è –ø—Ä–∏–º–µ—Ä–æ–≤

    Args:
        filename: –∏–º—è —Ñ–∞–π–ª–∞
        file_type: —Ç–∏–ø —Ñ–∞–π–ª–∞ ("technical_assignment", "documentation", "technical_requirements")

    Returns:
        (—É—Å–ø–µ—Ö, —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ)
    """
    if not filename:
        return False, "–§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω"

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞
    format_valid, format_error = validate_file_format(filename)
    if not format_valid:
        return False, format_error

    # –ü–æ–ª—É—á–∞–µ–º –∏–º—è –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    file_basename = Path(filename).stem.lower()

    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
    patterns = VALIDATION_EXAMPLES.get(file_type, [])

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∏–º—è —Ñ–∞–π–ª–∞ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
    matches = any(pattern.lower() in file_basename for pattern in patterns)

    if not matches:
        examples = ", ".join(VALIDATION_EXAMPLES[file_type][:3])
        return False, f"–ò–º—è —Ñ–∞–π–ª–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø—É '{file_type}'. –ü—Ä–∏–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∏–º—ë–Ω: {examples}"

    return True, ""


def validate_all_inputs(
    tz_file,
    doc_file,
    stage: str,
    req_type: str,
    tu_file=None
) -> Tuple[bool, str]:
    """
    –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

    Returns:
        (—É—Å–ø–µ—Ö, —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –µ—Å–ª–∏ –æ—à–∏–±–∫–∞)
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –¢–ó
    if tz_file is None:
        return False, json.dumps({"error": "–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω —Ñ–∞–π–ª —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è"}, ensure_ascii=False)

    valid, error = validate_file_by_name(tz_file.name, "technical_assignment")
    if not valid:
        return False, json.dumps({"error": f"–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: {error}"}, ensure_ascii=False)

    # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    if doc_file is None:
        return False, json.dumps({"error": "–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω —Ñ–∞–π–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"}, ensure_ascii=False)

    valid, error = validate_file_by_name(doc_file.name, "documentation")
    if not valid:
        return False, json.dumps({"error": f"–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: {error}"}, ensure_ascii=False)

    # –í–∞–ª–∏–¥–∞—Ü–∏—è –¢–£ –¥–ª—è –†–î –∏ –ü–î
    if req_type in ["–¢–£_–†–î", "–¢–£_–ü–î"]:
        if tu_file is None:
            return False, json.dumps({"error": f"–î–ª—è —Ç–∏–ø–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π '{REQUIREMENT_TYPES[req_type]}' –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π"}, ensure_ascii=False)

        valid, error = validate_file_by_name(tu_file.name, "technical_requirements")
        if not valid:
            return False, json.dumps({"error": f"–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è: {error}"}, ensure_ascii=False)

    return True, ""


# ============================
# –õ–û–ì–ò–ö–ê –û–ë–†–ê–ë–û–¢–ö–ò
# ============================

def process_documentation_analysis(
    tz_file,
    doc_file,
    stage: str,
    req_type: str,
    tu_file=None
) -> str:
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

    Args:
        tz_file: —Ñ–∞–π–ª —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
        doc_file: —Ñ–∞–π–ª –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
        stage: —Å—Ç–∞–¥–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
        req_type: —Ç–∏–ø —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
        tu_file: —Ñ–∞–π–ª —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

    Returns:
        –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ JSON —Å –æ—à–∏–±–∫–æ–π
    """
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    valid, error_msg = validate_all_inputs(tz_file, doc_file, stage, req_type, tu_file)
    if not valid:
        return error_msg

    # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏
    prompt = PROMPTS.get(stage, PROMPTS["–§–≠"])

    # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
    requirements_context = ""
    if req_type in ["–¢–£_–§–≠", "–¢–£_–≠–ü"]:
        requirements_context = EMBEDDED_REQUIREMENTS[req_type]
    elif req_type in ["–¢–£_–†–î", "–¢–£_–ü–î"] and tu_file:
        requirements_context = f"–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞: {tu_file.name}"
    else:
        requirements_context = f"–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞: {tz_file.name}"

    # –ó–ê–ì–õ–£–®–ö–ê: –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM
    # –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã
    result_table = f"""
## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–°—Ç–∞–¥–∏—è:** {STAGES[stage]}
**–¢–∏–ø —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π:** {REQUIREMENT_TYPES[req_type]}
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:** {Path(tz_file.name).name}
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** {Path(doc_file.name).name}
**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** {requirements_context}

---

| ‚Ññ | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∏–∑ –¢–ó | –°—Ç–∞—Ç—É—Å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è | –î–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å (%) | –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è | –°—Å—ã–ª–∫–∞ (–¥–æ–∫—É–º–µ–Ω—Ç, –ª–∏—Å—Ç/—Å—Ç—Ä–∞–Ω–∏—Ü–∞) | –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
|---|------------------|-------------------|-------------------|------------------|----------------------------------|----------------------------------------|--------------|
| 1 | –ü–ª–æ—â–∞–¥—å –∑–¥–∞–Ω–∏—è –Ω–µ –º–µ–Ω–µ–µ 5000 –º¬≤ | –ò—Å–ø–æ–ª–Ω–µ–Ω–æ | 95 | –í —Ä–∞–∑–¥–µ–ª–µ –ü–ó —É–∫–∞–∑–∞–Ω–∞ –æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å 5200 –º¬≤ | –ü–ó, —Å—Ç—Ä. 12 | - | - |
| 2 | –≠—Ç–∞–∂–Ω–æ—Å—Ç—å: –Ω–µ –±–æ–ª–µ–µ 10 —ç—Ç–∞–∂–µ–π | –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ | 80 | –û—Å–Ω–æ–≤–Ω–æ–µ –∑–¥–∞–Ω–∏–µ - 9 —ç—Ç–∞–∂–µ–π, –ø—Ä–∏—Å—Ç—Ä–æ–π–∫–∞ - 11 —ç—Ç–∞–∂–µ–π | –ê–†, –ª–∏—Å—Ç 3 | –ü—Ä–∏—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —ç—Ç–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏—Å—Ç—Ä–æ–π–∫–∏ |
| 3 | –ü–∞—Ä–∫–æ–≤–∫–∞ –Ω–∞ 100 –º–∞—à–∏–Ω–æ–º–µ—Å—Ç | –ù–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–æ | 100 | –í –ø—Ä–æ–µ–∫—Ç–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ 85 –º–∞—à–∏–Ω–æ–º–µ—Å—Ç | –ì–ü, –ª–∏—Å—Ç 1 | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∫–æ–≤–æ—á–Ω—ã—Ö –º–µ—Å—Ç | –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—à–∏–Ω–æ–º–µ—Å—Ç –¥–æ 100 |
| 4 | –ö–ª–∞—Å—Å —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ B+ | –¢—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è | 50 | –†–∞—Å—á–µ—Ç —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω | - | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–∑–¥–µ–ª —Ä–∞—Å—á–µ—Ç–∞ | –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Å–ø–æ—Ä—Ç |

---

**–ü—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
```
{prompt}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ LLM-–º–æ–¥–µ–ª—å—é.
"""

    return result_table


def update_tu_visibility(req_type: str):
    """
    –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¢–£ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

    Args:
        req_type: —Ç–∏–ø —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

    Returns:
        gr.update –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¢–£
    """
    if req_type in ["–¢–£_–†–î", "–¢–£_–ü–î"]:
        return gr.update(visible=True)
    else:
        return gr.update(visible=False)


# ============================
# GRADIO –ò–ù–¢–ï–†–§–ï–ô–°
# ============================

def create_interface():
    """–°–æ–∑–¥–∞–Ω–∏–µ Gradio –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞"""

    with gr.Blocks(title="–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏", theme=gr.themes.Soft()) as interface:
        gr.Markdown("""
        # üìã –ê–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é

        –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –¢–ó/–¢–£
        """)

        with gr.Row():
            # –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
            with gr.Column(scale=1):
                gr.Markdown("### üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤")

                tz_file = gr.File(
                    label="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ (–¢–ó)",
                    file_types=[".docx", ".pdf"],
                    type="filepath"
                )
                gr.Markdown("*–ü—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã: .docx, .pdf*")

                doc_file = gr.File(
                    label="–ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è",
                    file_types=[".docx", ".pdf"],
                    type="filepath"
                )
                gr.Markdown("*–ü—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã: .docx, .pdf*")

                tu_file = gr.File(
                    label="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è (–¢–£)",
                    file_types=[".docx", ".pdf"],
                    type="filepath",
                    visible=False
                )
                gr.Markdown("*–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è —Å—Ç–∞–¥–∏–π –†–î –∏ –ü–î*")

            # –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞
            with gr.Column(scale=1):
                gr.Markdown("### ‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞")

                stage = gr.Radio(
                    choices=list(STAGES.keys()),
                    label="–°—Ç–∞–¥–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏",
                    value="–§–≠",
                    info="–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–¥–∏—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"
                )

                req_type = gr.Radio(
                    choices=list(REQUIREMENT_TYPES.keys()),
                    label="–¢–∏–ø —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π",
                    value="–¢–ó",
                    info="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"
                )

                # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫
                gr.Markdown("""
                **‚ÑπÔ∏è –°–ø—Ä–∞–≤–∫–∞:**
                - **–ì–ö** - –ì—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è
                - **–§–≠** - –§–æ—Ä—ç—Å–∫–∏–∑–Ω—ã–π –ø—Ä–æ–µ–∫—Ç (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¢–£)
                - **–≠–ü** - –≠—Å–∫–∏–∑–Ω—ã–π –ø—Ä–æ–µ–∫—Ç (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¢–£)
                - **–ü–î** - –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ –¢–£)
                - **–†–î** - –†–∞–±–æ—á–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ –¢–£)
                """)

        # –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∞–Ω–∞–ª–∏–∑–∞
        analyze_btn = gr.Button("üîç –í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑", variant="primary", size="lg")

        # –û–±–ª–∞—Å—Ç—å –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        gr.Markdown("### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞")
        output = gr.Markdown(label="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã")

        # –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
        req_type.change(
            fn=update_tu_visibility,
            inputs=[req_type],
            outputs=[tu_file]
        )

        analyze_btn.click(
            fn=process_documentation_analysis,
            inputs=[tz_file, doc_file, stage, req_type, tu_file],
            outputs=[output]
        )

        # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        gr.Markdown("""
        ---
        ### üìö –ü—Ä–∏–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∏–º—ë–Ω —Ñ–∞–π–ª–æ–≤

        **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:**
        - `tz_project.docx`, `tech_assignment.pdf`, `tz_rd.docx`

        **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
        - `documentation_fe.pdf`, `docs_project.docx`, `fe_docs.pdf`

        **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è:**
        - `requirements_tu.docx`, `project_tu.pdf`, `tech_requirements.pdf`

        *–°–ª–æ–≤–∞—Ä—å –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏: [naming-conventions](https://example.com/naming-conventions)*
        """)

    return interface


# ============================
# –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
# ============================

if __name__ == "__main__":
    print("üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏...")

    interface = create_interface()

    # –ó–∞–ø—É—Å–∫ –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö
    interface.launch(
        server_name="0.0.0.0",
        server_port=7860,
        share=False
    )
