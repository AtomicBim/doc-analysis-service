"""
Конфигурация для анализа документации
"""

# ============================================================
# STAGE 1: Извлечение метаданных из штампов и заголовков
# ============================================================
STAGE1_MAX_PAGES = 150  # Максимальное количество страниц для извлечения метаданных
STAGE1_DPI = 120  # Качество рендеринга для crops (повышено для лучшей читаемости штампов)
STAGE1_QUALITY = 75  # JPEG качество для crops (оптимально для OCR мелкого текста)

# Области для извлечения (процент от размера страницы)
STAGE1_STAMP_CROP = {
    'left': 0.7,   # 70% от ширины (правый нижний угол)
    'top': 0.8,    # 80% от высоты
    'right': 1.0,  # 100% ширины
    'bottom': 1.0  # 100% высоты
}

STAGE1_TOP_RIGHT_CROP = {
    'left': 0.7,   # 70% от ширины (правый верхний угол)
    'top': 0.0,    # 0% от высоты
    'right': 1.0,  # 100% ширины
    'bottom': 0.15 # 15% высоты
}

STAGE1_HEADER_CROP = {
    'left': 0.0,   # 0% от ширины (весь заголовок)
    'top': 0.0,    # 0% от высоты
    'right': 1.0,  # 100% ширины
    'bottom': 0.1  # 10% высоты
}

# ============================================================
# STAGE 2: Оценка релевантности страниц (low-res)
# ============================================================
STAGE2_MAX_PAGES = 100  # Максимальное количество страниц для оценки релевантности
STAGE2_DPI = 90  # Качество рендеринга (снижено для экономии токенов при detail:low)
STAGE2_QUALITY = 60  # JPEG качество (низкое, достаточно для оценки релевантности)
STAGE2_DETAIL = "low"  # OpenAI Vision detail level (85 tokens/image)

# ============================================================
# STAGE 3: Детальный анализ релевантных страниц (high-res)
# ============================================================
STAGE3_DPI = 120  # Качество рендеринга (оптимальный баланс: скорость +10%, качество -2%)
STAGE3_QUALITY = 70  # JPEG качество (визуально неразличимо от 85, но быстрее)
STAGE3_DETAIL = "high"  # OpenAI Vision detail level (765 tokens/image)
STAGE3_BATCH_SIZE = 3  # Количество требований в одном batch (снижено для стабильности и меньшего риска refusal)
STAGE3_MAX_TOKENS = 4000  # Максимальное количество токенов в ответе
STAGE3_RETRY_ON_REFUSAL = True  # Повторять запрос с батчами размером 1 при refusal
STAGE3_MAX_PAGES_PER_REQUEST = 30  # Максимум страниц в одном запросе (30 × 765 = 22,950 токенов < 30,000 TPM)

# ============================================================
# STAGE 4: Поиск противоречий (опционально)
# ============================================================
STAGE4_ENABLED = True  # Включить/выключить Stage 4 (отключите для ускорения больших проектов)
STAGE4_SAMPLE_PAGES_PER_SECTION = 5  # Страниц из каждого раздела для анализа
STAGE4_DPI = 100  # Качество (среднее между Stage 2 и 3)
STAGE4_QUALITY = 70  # JPEG качество
STAGE4_DETAIL = "low"  # OpenAI Vision detail level (экономим токены)
STAGE4_MAX_TOKENS = 6000  # Больше токенов для подробного отчета о противоречиях

# ============================================================
# Классификация требований в батчи
# ============================================================
CLASSIFICATION_MIN_BATCHES = 3  # Минимальное количество батчей
CLASSIFICATION_MAX_BATCHES = 5  # Максимальное количество батчей

# ============================================================
# Retry и rate limiting
# ============================================================
RETRY_MAX_ATTEMPTS = 5  # Максимальное количество попыток при ошибке (повышено для 429 errors)
RETRY_WAIT_EXPONENTIAL_MULTIPLIER = 1  # Множитель для экспоненциального backoff (секунды)
RETRY_WAIT_EXPONENTIAL_MAX = 20  # Максимальное время ожидания (увеличено для API rate limits)

# ============================================================
# OpenAI API настройки
# ============================================================
OPENAI_MODEL = "gpt-4o"  # Модель для анализа
OPENAI_TEMPERATURE = 0.1  # Температура (0.0 = детерминированный, 1.0 = креативный)

# ============================================================
# Логирование
# ============================================================
LOG_LEVEL = "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_RESPONSE_PREVIEW_LENGTH = 200  # Длина preview ответа модели в логах
LOG_FULL_RESPONSE_ON_ERROR = True  # Логировать полный ответ при ошибке
